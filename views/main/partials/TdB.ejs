<!--Tableau de bord-->
<div class="side-bar">
    <h4>
        Tableau de bord
    </h4>
    <br /><br />
    <ul style="width: 150px;">
        <li style="vertical-align: middle;">
            <%= general.format_number(joueur.Ressources.Argent) %>
            <img src="/images/picto/argent.png" alt="Argent" title="Argent"  style="width: 24px; height: 24px;display: inline;vertical-align: middle; float: right;"/>
        </li>
        <li style="vertical-align: middle;">
            <%= general.format_number(joueur.Ressources.Aluminium) %>
            <span style="float: right;">Alu.</span>
        </li>
        <li style="vertical-align: middle;">
            <%= general.format_number(joueur.Ressources.Titane) %>
            <span style="float: right;">Titane</span>
        </li>
        <li style="vertical-align: middle;">
            <%= general.format_number(joueur.Ressources.Carbone) %>
            <span style="float: right;">Carbone</span>
        </li>
        <li style="vertical-align: middle;">
            <%= general.format_number(joueur.Ressources.Uranium) %>
            <img src="/images/picto/uranium.png" alt="Uranium" title="Uranium"  style="width: 24px; height: 24px;display: inline;vertical-align: middle; float: right;"/>
        </li>
        <li style="vertical-align: middle;">
            <%= general.format_number(joueur.Ressources.Energie) %>
            <img src="/images/picto/energie.png" alt="Energie" title="Energie" style="width: 24px; height: 24px;display: inline;vertical-align: middle; float: right;"/>
        </li>
        <li style="vertical-align: middle;">
            <%= general.format_number(joueur.Ressources.Matiere_Premiere) %>
            <img src="/images/picto/MP2.png" alt="Matière première" title="Matière Première" style="width: 24px; height: 24px;display: inline;vertical-align: middle; float: right;"/>
        </li>
    </ul>
    <div id="bilans">
		<ul>
			<li title="Bilans" class="active">Bilans</li>
			<li title="Armees">Armées</li>
			<li title="Espionnages">Espionnages</li>
			<li title="Commerces">Commerces</li>
		</ul>
		<table class="list-Bilans" style="border-collapse: collapse;">
		</table>
		<div class="list-Armees">
			<table>
				<tr>
					<td>Rapport d'attaque</td>
					<td>18/11 18:57</td>
				</tr>
			</table>
		</div>
		<div class="list-Espionnages">
			<table>
				<tr>
					<td>Rapport d'espionnage</td>
					<td>18/11 18:57</td>
				</tr>
			</table>
		</div>
		<div class="list-Commerces">
			<table>
				<tr>
					<td>Rapport d'échange</td>
					<td>18/11 18:57</td>
				</tr>
			</table>
		</div>

   	</div>
</div>

<script>
	var BilansModel = Backbone.Model.extend({
		defaults: {
            Titre: 'Pas de bilans',
            Date : '-'
        },
        urlRoot: '/bilans'
    });

	var SailsCollection = Backbone.Collection.extend({
		sailsCollection: "",
		socket: null,
		sync: function(method, model, options) {
		var where = {JoueursId: <%= joueur.idJoueurs %>};
		if (options.where) {
			where = {
				where: options.where
			}
		}
		if(typeof this.sailsCollection === "string" && this.sailsCollection != "")
		{
			this.socket = io.connect();
			this.socket.on("connect", _.bind(function() {
				this.socket.request("/" + this.sailsCollection, where, _.bind(function (joueurs) {
					this.set(joueurs);
					}, this));

					this.socket.on("bilan<%=session.socketSession%>", _.bind(function (bilan) {
						var m = bilan.verb;
						if (m === "create") {
							this.add(bilan.data);
						}
						else if (m === "update") {
							this.get(bilan.data.id).set(bilan.data);
						}
						else if (m === "destroy") {
							this.remove(this.get(bilan.data.id));
						}
					}, this));
				}, this));
			}
			else
			{
				console.log("Error : Cannot retrieve models because property 'sailsCollection' not set on the collection.");
			}
		}
	});


	var BilansCollection = SailsCollection.extend({
		sailsCollection: 'bilans',
		model: BilansModel,
	});

	var bilans = new BilansCollection();
	bilans.fetch();
	var bilan = new BilansModel();

	

	_.templateSettings = {
    interpolate : /\{\{(.+?)\}\}/g
};

	var BilansView = Backbone.View.extend({
    el: '.list-Bilans',
    initialize: function () {
        this.collection.on('add', this.render, this);
        this.render();
    },
    template: _.template("<tr><td style=\"width: 60%;\">{{ Titre }} </td><td style=\"with: 33%\">{{ Date }}</td><td style=\"width: 7%; text-align: center\"><img src='/images/picto/nonLu.png' /></td></tr>"),
        render: function () {
            this.$el.html("");
            this.collection.each(function(bilan){
                this.$el.append(this.template(bilan.toJSON()));
            }, this);
    	}
	});
 
	var mView = new BilansView({collection: bilans});

	$("#bilans ul li").click(bilanChange);

	function bilanChange()
	{
		var current_section = $("#bilans ul li.active");
		var next_section = $(this);

		current_section.removeClass("active");
		$(".list-"+current_section.attr("title")).hide();
		next_section.addClass("active");
		$(".list-"+next_section.attr("title")).show();

	}
</script>